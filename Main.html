<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Otonashi</title>
    <link rel="stylesheet" type="text/css" href="./style/style.css" charset="utf-8"/>
</head>
<body>
<div class="Main">
    <div class="Title">
        MPEG-1/Audio Layer 3 Codec
        <div style="
            height:2px;
            background-image: linear-gradient(to right, rgb(255, 94, 134), rgb(210, 162, 255), rgb(36, 200, 255));
        "></div>
    </div>

    <div class="Block" style="text-align: center;">
        <div style="text-align: left; line-height: 23px; color:#666;">
            ⭐ 打开控制台以查看输出信息
        </div>

        <div style="text-align: left; margin: 10px 0; padding: 10px; border-radius: 5px; background: #e1f5ff; font-weight: bold;">
            打开音频文件（WAV、MP3等均可）：<input type="file" id="fileSelector" name="files[]" multiple>
        </div>

        <div style="margin: 10px 0;">
            <button id="play" data-state="stopped"><span id="playLabel">播放</span><svg id="ThrobberPlaying" version="1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="transform: scale(1); display: none; position: relative; top: 3px; left: 3px;"><style>@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes fillunfill{0%{stroke-dashoffset:32.3}50%{stroke-dashoffset:0}to{stroke-dashoffset:-31.9}}@keyframes rot{0%{transform:rotate(0deg)}to{transform:rotate(-360deg)}}@keyframes colors{0%,to{stroke:#00aaff}}</style><g style="animation-duration:1568.63ms;animation-iteration-count:infinite;animation-name:rotate;animation-timing-function:linear;transform-origin:50% 50%;width:16px;height:16px"><path fill="none" d="M8 1.125A6.875 6.875 0 1 1 1.125 8" stroke-width="2.25" stroke-linecap="round" style="animation-duration:1333ms,5332ms,5332ms;animation-fill-mode:forwards;animation-iteration-count:infinite,infinite,infinite;animation-name:fillunfill,rot,colors;animation-play-state:running,running,running;animation-timing-function:cubic-bezier(.4,0,.2,1),steps(4),linear;transform-origin:50% 50%" stroke-dasharray="32.4" stroke-dashoffset="32.4"></path></g></svg></button>
        </div>
        <div class="ProcessbarContainer">
            <div id="progressbar" style="height: 100%; background-color: #00aaff; width: 5px;"></div>
            <div id="timer" style="position: absolute; top: 0; left: 0; font-size: 14px; height: 15px; line-height: 15px; margin: 5px 10px;"></div>
        </div>

        <pre id="output" style="text-align: left; background-color: black; color:#eee; padding: 10px; border-radius: 10px; overflow-x: auto;"></pre>

        <!-- <canvas id="osc0"  height="100px" width="300px"></canvas></td><td><canvas id="osc1"  height="100px" width="300px"></canvas> -->

    </div>

    <div style="text-align: center; font-size: 13px; color:#888888; margin: 20px auto; line-height: 20px;">
        <div><a href="https://github.com/mikukonai/MP3-Study">GitHub</a></div>
        <div>Copyright &copy; 2019-2020 Mikukonai</div>
    </div>

</div>

<script src="./script/jquery.min.js"></script>


<script src="PCMData.js"></script>
<script src="Constants.js"></script>
<script src="GlobalSettings.js"></script>

<script src="Utils.js"></script>
<script src="Huffman.js"></script>
<script src="FFT.js"></script>
<script src="AnalysisSubbandFilter.js"></script>
<script src="PsychoacousticModel2.js"></script>
<script src="MDCT.js"></script>
<script src="Reservoir.js"></script>
<script src="QuantizationLoop.js"></script>
<script src="Stream.js"></script>

<script src="Decoder.js"></script>

<script src="Main.js"></script>

<script>

let spect = [108,106,102,96,89,79,69,56,41,25,5,-16,-25,-29,-27,-18,5,19,-37,-39,-37,-31,-24,-17,-11,-5,3,8,13,16,18,19,17,12,1,-9,18,18,15,9,1,-7,-10,-11,-12,-13,-13,-14,-15,-16,-16,-14,-9,-3,-5,-7,-5,1,6,10,14,18,23,28,32,35,38,37,34,26,13,-6,23,27,26,22,17,13,11,9,7,6,4,3,1,0,0,4,8,10,-17,-17,-16,-14,-12,-10,-8,-6,-4,-1,3,6,8,9,10,9,5,0,5,6,3,-2,-5,-7,-8,-8,-8,-8,-7,-7,-6,-5,-3,-1,3,4,-8,-8,-8,-8,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,4,-5,-5,-5,-5,-5,-4,-4,-4,-3,-3,-2,-2,-2,-2,-3,-3,-3,-2,3,4,5,7,8,9,10,11,11,11,11,11,10,9,7,5,2,-2,5,6,6,6,5,4,3,2,1,-1,-2,-3,-3,-4,-3,-3,-2,0,-2,-2,-3,-3,-3,-3,-3,-2,-2,-2,-1,0,0,1,2,2,2,2,-2,-2,-2,-2,-2,-1,-1,0,0,1,2,2,2,3,3,2,2,1,0,0,0,0,-1,-1,-1,-2,-2,-3,-3,-3,-3,-4,-4,-4,-3,-3,3,2,2,2,2,2,2,2,1,0,0,-1,-1,-1,-1,-1,-1,-1,1,0,0,0,0,-1,0,0,0,1,1,1,2,2,2,2,2,2,-3,-2,-2,-2,-2,-2,-1,-1,0,1,2,2,3,3,3,2,1,-1,3,3,3,2,2,1,0,-1,-2,-3,-3,-4,-4,-5,-5,-4,-3,-2,1,0,0,1,2,2,2,1,0,-1,-2,-2,-3,-3,-3,-2,-1,0,-2,-2,-2,-2,-1,0,0,1,1,2,2,2,2,2,2,2,2,1,-1,-1,-1,-2,-2,-3,-3,-2,-2,-2,-1,-1,0,1,1,1,1,0,1,1,0,-1,-1,-2,-2,-2,-2,-3,-3,-3,-3,-2,-2,-1,0,1,-2,-2,-2,-2,-1,-1,0,0,0,0,-1,-1,-1,-1,-1,-1,0,1,-2,-2,-1,-1,0,1,1,2,2,2,3,3,3,3,2,2,1,0,1,1,1,0,0,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,-1,1,1,1,1,1,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,1,1,1,0,0,0,0,-1,-1,-1,-1,-1,-1,0,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,1,0,1,1,1,1,1,1,0,0,0,-1,-1,-1,-1,-1,0,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,1,1,1,1,1,1,1,0];

LOG(`===== 编码前 =====`);
LOG(spect);

let huffman = HuffmanEncode(spect, WINDOW_START);
LOG(`===== 编码结果 =====`);
LOG(huffman);

let spectDecoded = HuffmanDecode(
    huffman.codeString,
    huffman.blockType,
    huffman.bigvalues,
    huffman.region0Count,
    huffman.region1Count,
    huffman.bigvalueTableSelect,
    huffman.smallvalueTableSelect
);
LOG(`===== 解码后 =====`);
LOG(spectDecoded);

LOG(`===== 结果校验 =====`);
let ispass = true;
for(let i = 0; i < 576; i++) {
    if(spect[i] !== spectDecoded[i]) {
        ispass = false;
        console.error(`编/解码错误`);
    }
}
if(ispass) { LOG(`编解码结果正确`); }

</script>

</body>
</html>
